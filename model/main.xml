<mujoco model="Brickiebot">

  <!-- <compiler meshdir="assets"/> -->
  <include file="scene.xml"/>
  <include file="assets/assets/ufactory_lite6/lite6V2.xml"/>
  <option timestep="0.001" jacobian="dense" noslip_iterations="5"/>
  <option><flag multiccd="enable"/> </option>
  <size nconmax="500" njmax="1500" nkey="1"/>


<!-- class allow to separate different type of mesh -->
<default>
  <default class="crane" >
    <geom type="mesh"/>
      <default class="visual1">
        <geom contype="0" conaffinity="0" group="2" material="white"/>
      </default>
      <default class="collision1">
        <geom group="3" mass="0" density="0"/>
      </default>
    </default>
</default>


    <asset>
      <mesh name="crane_body"   scale="0.001 0.001 0.001" file="crane_body.stl"/>
      <mesh name="brick"        scale="0.001 0.001 0.001" file="brick.stl"/>
      <mesh name="end_effector" scale="0.001 0.001 0.001" file="end_effector.stl"/>
      <mesh name="rails"        scale="0.001 0.001 0.001" file="rails.stl"/>

      <mesh name="grab1_left"    scale="1 1 2" file="grab1_left.stl"/>
      <mesh name="grab1_right"   scale="1 1 2" file="grab1_right.stl"/>

      <texture name="arUcoPic" type="2d" file="arUco.png" />
      <material name="arUco" texture="arUcoPic"/>
    </asset>


  <worldbody>
    <light pos=".5 0 2"/>

    <body name="shaft_structure" childclass="crane">
      <body name="crane_body" pos="0 0 0">
        <geom class="visual1" mesh="crane_body"/>
      </body>

      <body name="end_effector" pos="0 0 0">
        <geom class="visual1" mesh="end_effector"/>
      </body>

      <body name="rails" pos="0 0 0">
        <geom class="visual1" mesh="rails"/>
      </body>
    </body>

    <body name="brick" pos="0.2 0.3 0.016">
      <geom type="mesh" mesh="brick" mass="0.001"/>
      <joint type='free' />      
      <!-- <joint name="brickX" type="slide" limited="false" actuatorfrclimited="false" axis="1 0 0"/>
      <joint name="brickY" type="slide" limited="false" actuatorfrclimited="false" axis="0 1 0"/>
      <joint name="brickZ" type="slide" limited="false" actuatorfrclimited="false" axis="0 0 1"/> -->
      <!-- stiffness='1'  armature='0'    frictionloss='0.1'  damping='0.00001' -->
    </body>

    
    <!-- ############################################### TENDON TYPE HERE ############################################## -->

    <body name="beam" pos="0 0 0.3785" quat="0 1 0 1">
      <geom type="box" size="0.001 0.001 0.001" pos="0.015 0 0" rgba=".8 .8 .8 1" mass="0.0001"/>
      <camera name="gripper_cam" quat="0 1 0 1" pos="0.015 0 0"/>
      <body name="slider" pos="0 0 0">
        <geom type="cylinder" density="100" size=".015 .005 .015" rgba="0 1 0 1" mass="10"/>
        <geom type="cylinder" density="100" size=".02 .0025 .02" pos="0 0 0.0075" rgba="0 1 0 1" mass="10"/>
        <geom type="cylinder" density="100" size=".02 .0025 .02" pos="0 0 -0.0075" rgba="0 1 0 1" mass="10"/>
      </body>
    </body> 

    <body name="moving_box" pos="0 0.015 0.41" quat="0 1 0 1">
      <geom type="box" size=".001 .001 .001" rgba=".5 .2 .8 1" mass="1"/>
      <body name="rope" pos="0 0 0"  quat="0 0 1 1">
          <composite type="cable" count="50 1 1" curve="s 0 0" offset="0 0 0" prefix="rope" initial="ball" size="0.39 1 1">
            <joint kind="main" damping="0.01" armature="0.001"/>
            <geom type="capsule" size=".0005 .001 0.3" rgba=".8 .2 .1 1"/>
          </composite>
        </body>
      <joint name="slider" type="slide" axis="0 1 0" pos="0 0 0" damping="1"/>
    </body> 

    <body name="payload" pos="0 0.015 0.02">
      <geom type="sphere" size=".001 .001" density="100" rgba=".5 .2 .8 1" mass="0.01"/>
      <!-- <site name="sphere_0" pos="0 0 0" size="0.0015" rgba="1 0 0 1"/> -->
      <freejoint/>
      <!-- <geom type="cylinder" size=".001 .001" density="100"  rgba=".5 .2 .2 .5"/> -->
    </body>


    <!-- TODO mettre en place le gripper avec la pince qui bouge -->
<!-- ################################################ GRIPPER ################################################# -->
  <body name="gripper_rope" pos="0 0.015 0.02" quat="0 0 0 1">
    <site name="IMU" size="0.0001 0.0001 0.0001"/>
    <joint name="gripper_jointX" type="slide" limited="false" actuatorfrclimited="false" axis="1 0 0"/>
    <joint name="gripper_jointY" type="slide" limited="false" actuatorfrclimited="false" axis="0 1 0"/>
    <joint name="gripper_jointZ" type="slide" limited="false" actuatorfrclimited="false" axis="0 0 1"/>

    <geom type="box" size="0.05 0.02 0.001" rgba=".8 .8 .8 1" mass="0.0001"/>
    <geom type="box" size="0.02 0.02 0.001" pos="0 0 0.0001" material="arUco" rgba=".8 .8 .8 1" mass="0.0001"/>

    <body name="gripper_left" pos="0.05 0 -0.02"  quat="0 0 1 1">
      <geom type="box" size="0.004 0.02 0.01" rgba=".2 .2 1 1" mass="0.0001"/>
      <joint name="gripper_left_joint" type="slide" axis="1 0 0" pos="0 0 0" damping="1"/>
      <body name="gripper2_left" pos="0 0 0"  quat="0 0 0 1">
        <geom type="mesh"  mesh="grab1_left" rgba=".2 .2 1 1" mass="0.0001"/>
      </body>
    </body>
    <body name="gripper_right" pos="-0.05 0 -0.02"  quat="0 0 1 1">
      <geom type="box" size="0.004 0.02 0.01" rgba=".2 .2 1 1" mass="0.0001"/>
      <joint name="gripper_right_joint" type="slide" axis="1 0 0" pos="0 0 0" damping="1"/>
      <body name="gripper2_right" pos="0 0 0"  quat="0 0 0 1">
        <geom type="mesh"  mesh="grab1_right" rgba=".2 .2 1 1" mass="0.0001"/>
      </body>
    </body>
  </body>


<!-- ################################################## WALL ################################################## -->
    <body name="brickWallFloor0_0" pos="0 0.1 0.016">
      <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/>
      <geom type="mesh" mesh="brick" mass="0.01"/>
      <body name="brickWallFloor0_1" pos="0 0.06 0">
        <geom type="mesh" mesh="brick" mass="0.01"/>
        <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
      </body>
      <body name="brickWallFloor0_2" pos="0 0.12 0">
        <geom type="mesh" mesh="brick" mass="0.01"/>
        <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
      </body>
      <body name="brickWallFloor0_3" pos="0 0.18 0">
        <geom type="mesh" mesh="brick" mass="0.01"/>
        <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
      </body>

      <body name="brickWallFloor1_0" pos="0 0 0.03">
        <geom type="mesh" mesh="brick" mass="0.01"/>
        <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
      
        <body name="brickWallFloor1_1" pos="0 0.06 0">
          <geom type="mesh" mesh="brick" mass="0.01"/>
          <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        </body>
        <body name="brickWallFloor1_2" pos="0 0.12 0">
          <geom type="mesh" mesh="brick" mass="0.01"/>
          <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        </body>
        <body name="brickWallFloor1_3" pos="0 0.18 0">
          <geom type="mesh" mesh="brick" mass="0.01"/>
          <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        </body>   
      </body>

      <body name="brickWallFloor2_0" pos="0 0 0.06">
        <!-- <geom type="mesh" mesh="brick" mass="0.01"/> -->
        <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        <body name="brickWallFloor2_1" pos="0 0.06 0">
          <geom type="mesh" mesh="brick" mass="0.01"/>
          <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        </body>
        <body name="brickWallFloor2_2" pos="0 0.12 0">
          <geom type="mesh" mesh="brick" mass="0.01"/>
          <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        </body>
        <body name="brickWallFloor2_3" pos="0 0.18 0">
          <geom type="mesh" mesh="brick" mass="0.01"/>
          <!-- <joint type='free' stiffness='1' damping='0.00001' frictionloss='1' armature='0'/> -->
        </body>
      </body>
    </body>

  </worldbody>



  <equality>
    <weld body1="payload" body2="ropeB_last" active="true" anchor="0 0 0" torquescale="0"/>
    <weld body1="gripper_rope" body2="payload" active="true" anchor="0 0 0" torquescale="0"/>
  </equality>

<!-- gripper_rope -->
  <actuator>
    <position joint="slider" ctrllimited="true" ctrlrange="-1 1"/> 
    <adhesion name="adhere_arm" body="payload" ctrlrange="0 1" gain="5"/>

    <position name="gipper_left" joint="gripper_left_joint" ctrllimited="true" ctrlrange="0 0.035" kp="12"/> 
    <position name="gripper_right" joint="gripper_right_joint" ctrllimited="true" ctrlrange="-0.035 0" kp="10"/> 
  </actuator>

  <sensor>
    <accelerometer site="IMU" name="accelerometer"/>
  </sensor>

</mujoco>  

